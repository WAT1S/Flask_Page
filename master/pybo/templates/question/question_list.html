{% extends "base.html" %}
{% block content %}
<div class="container my-3 mt-0">
  <div class="row justify-content-end my-3">
    <div class="col-4 input-group">
      <input type="text" class="form-control kw" value="{{ kw or '' }}">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" id="btn_search">찾기</button>
      </div>
    </div>
  </div>
  <table class="table">
    <thead>
      <tr class="table-dark">
        <th class="mobile">N</th>
        <th style="width:50%">Subject</th>
        <th>Writer</th>
        <th>Create_date</th>
      </tr>
    </thead>   
    <tbody>
    {% if question_list %}  
    {% for question in question_list.items %}  
      <tr class="text-left">
        <td class="mobile"> {{ (( question_list.per_page * question_list.page ) - question_list.per_page ) + loop.index }} </td>
        <td class="text-left">
          <a class="link_cont" href="{{ url_for('question.detail', question_id = question.id) }}">{{ question.subject }} </a>
        {% if question.answer_set|length > 0 %}
          <span class="small text-danger ml-5">{{ (question.answer_sel|length + 1) }}</span>
        {% endif %}
        </td>
        <td> {{ question.user.username }} </td>
        <td class="pc_time"> {{ question.create_date|datetime }}</td>
        <td class="mobile_time"> {{ question.create_date|dateymdtime}}</td>
      </tr>
    {% endfor %}  
    {% else %}  
      <tr>
        <td colspan="3">There is no data present</td>
      </tr>
    {% endif %}  
    </tbody>
  </table>
  
  <ul class="pagination justify-content-center">
    {% if question_list.has_prev %}
    <li class="page-item">
      <a class="page-link" data-page="{{ question_list.prev_num }}" href="#">prev</a>
    </li>
  {% else %}
    <li class="page-item">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="true">prev</a>
    </li>
  {% endif %}
  {% for page_num in question_list.iter_pages() %}
    {% if page_num %}
      {% if page_num != question_list.page %}
      <li class="page-item">
        <a class="page-link" data-page="{{ page_num }}" href="#">{{ page_num }}</a>
      </li>
      {% else %}
      <li class="page-item active">
        <a class="page-link" href="#">{{ page_num }}</a>
      </li>
      {% endif %}
    {% else %}
      <li class="disable">
        <a class="page-link">...</a>
      </li>
    {% endif %}  
  {% endfor %}
  {% if question_list.has_next %}
    <li class="page-item">
      <a class="page-link"data-page="{{ question_list.next_num }}" href="#">next</a>
    </li>
  {% else %}
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1" aria-disabled="true">next</a>
    </li>
  {% endif %}
  </ul>
  <div class="d-flex justify-content-end">
  <a href="{{ url_for('question.create') }}" class="btn btn-primary ">게시물 등록</a>
  </div>
  <form id="searchForm" method="get" action="{{url_for('question._list') }}">
    <input type="hidden" id="kw" name="kw" value="{{ kw or '' }}">
    <input type="hidden" id="page" name="page" value="{{ page }}">
  </form>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
  $(document).ready(fucntion(){
    $(".page-link").on("click", function(){
      $("#page").val($(this).data("page"))
      $("#searchForm").submit()
    });
    
    $("#btn.search").on("click", function(){
      $("#kw").val($(".kw").val())
      $("#page").val(1)
      $("#searchForm").submit();
    });
  });


  $(window).resize(function(){
    width_size = $(window).width() 
    if(width_size < 768){
      $(".mobile").hide();
      $(".pc_time").hide();
      $(".mobile_time").show();
    };
  });

  $(window).resize(function(){
    width_size = $(window).width()
    if(width_size > 768){
      $(".mobile").show();
      $(".pc_time").show();
      $(".mobile_time").hide();
    };
  });
</script>
{% endblock %}